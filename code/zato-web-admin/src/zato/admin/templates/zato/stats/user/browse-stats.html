{% extends "zato/index.html" %}
{% load extras %}
{% block html_title %}User defined statistics{% endblock %}

{% block "extra_css" %}
    <link rel="stylesheet" type="text/css" href="/static/css/stats-user.css">
{% endblock %}

{% block "extra_js" %}

<script type="text/javascript" src="/static/js/common.js"></script>
<script type="text/javascript" src="/static/frappe-charts/frappe-charts.min.iife.js"></script>

<script>
    $(document).ready(function() {
        $('#check-all-rows').click(function () {
            $('.row-checkbox').prop('checked', this.checked)
        })
    });
</script>
{% endblock %}

{% block "content" %}
<h2 class="zato">User defined statistics</h2>

{% if not zato_clusters %} {% include "zato/no-clusters.html" %} {% else %}

{% if cluster_id %}

<div id="markup">

    <div style="text-align: cente2r !important;">
    <br/>

    <form action=".">
    <table id="data-table" style="width:70%; margin: auto">

        <thead>
            <tr>
                <td colspan="9999">

                    <div id="chart1"></div>

                    <script>

                        // ////////////////////////////////////////////////////////////////////////////////////////

                        const data1 = {

                            labels:
                            [
                                1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
                                21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
                                41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60
                            ],

                            yMarkers: [{
                                label: "Max. result",
                                value: 60,
                                options: { labelPos: 'left' }
                                }
                            ],

                            datasets: [
                                {
                                    name: "janet.smith@example.com", type: "line",
                                    values: [
                                        2, 9, 9, 12,
                                        12, 12, 12, 12,
                                        15, 15,
                                        19, 19, 19, 19,
                                        19, 19, 19, 19,
                                        19, 23, 26, 26,
                                        26, 33, 33, 33,
                                        33, 33, 33, 33,
                                        37, 56, 56, 56,
                                        56, 57, 59
                                ]
                                },
                                {
                                    name: "", type: "line",
                                    values: []
                                },

                            ]
                            }

                            const chart1 = new frappe.Chart("#chart1", {
                                title: "Result; 2022-02-13 11:56",
                                data: data1,
                                type: 'line',
                                colors: ['#6666ff', '#6666ff'],
                                xvaluesOverPoints: 1,
                                isNavigable: true,

                            axisOptions: {
                                xAxisMode: 'span',
                                yAxisMode: 'span',
                                xIsSeries: true
                            },
                            barOptions: {
                                spaceRatio: 2 // default: 1
                            },
                            lineOptions: {
                                dotSize: 2,
                                spline: 0,
                                hideDots: false,
                            },
                            tooltipOptions: {
                                formatTooltipX: d => d + ' min.',
                                formatTooltipY: d => (d || '40') + ' pts.' ,
                            }
                            });

                    </script>
                </td>
            </tr>
        </thead>

        <thead>
            <tr class='ignore'>
                <td colspan="3" style="text-align: left;">
                    ← <a href="?cluster={{ cluster_id }}">Back to main page </a>
                </td>
                <td colspan="5" style="text-align: right;">
                        {% for container in dicts.containers %}
                        {% with req_value=req.GET|get_item:container.name %}
                        <select name={{ container.name }}>
                            <option value="">---</option>

                            {% if container.datatype == "email" %}
                                {% for key, values in container.elems.items %}

                                    <option value="{{ key }}" class="group"
                                        {% if key|endswith:req_value %}
                                            selected="selected"
                                        {% endif %}
                                    >◾️ {{ key|upper }}</option>
                                    {% for value in values %}
                                        <option value="{{ value.key }}" class="value"
                                            {% if req_value == value.key %}
                                                selected="selected"
                                            {% endif %}
                                        >{{ value.key }}</option>
                                    {% endfor %}
                                {% endfor %}
                            {% else %}
                                {% for elem in container.elems %}
                                    <option value="{{ elem.key.id }}" class="value"
                                        {% if req_value == elem.key.id %}
                                            selected="selected"
                                        {% endif %}
                                    >{{ elem.key.name }}</option>
                                {% endfor %}
                            {% endif %}

                        </select>
                        {% endwith %}
                        {% endfor %}

                        <input type="hidden" name="action" value="BrowseStats"/>

                        <input type="submit" value="List">
                        <input type="button" value="Display" onclick="location.href='?cluster_id={{ cluster_id }}&amp;action=DisplayStats'"/>
                        <input type="button" value="Compare" onclick="location.href='?cluster_id={{ cluster_id }}&amp;action=CompareStats'"/>
                </td>
            </tr>
        </thead>
        <thead>
            <tr class='ignore'>
                <th>
                    {% if items %}
                        <input type="checkbox" id="check-all-rows" />
                    {% endif %}
                </th>
                <th>&nbsp;</th>
                {% for column in columns %}
                    <th style="text-align: {{ column.align }}"><a href="#">{{ column.data }}</a></th>
                {% endfor %}
        </thead>

        <tbody>
            {% if items %}
                {% for item in items %}
                <tr class="{% cycle 'odd' 'even' %}" id='tr_{{ item.id }}'>
                    <td><input type="checkbox" class="row-checkbox" name="{{ form_item_id_prefix }}{{ item.id }}" /></td>
                    <td class='numbering' style="width:10px">&nbsp;</td>
                        {% for cell in item.cells %}
                            {% with cell_idx=cell.idx %}
                            {% with cell_column=columns|get_item:cell_idx %}
                            <td style="text-align: {{ cell.align|default:'left' }}">
                                {% if cell.data %}
                                    {% if cell.datatype == "link" %}
                                        <a href="?{{ form_item_id_prefix }}{{ item.id }}=on&amp;action=DisplayStats">{{ cell.data }}</a>
                                    {% elif cell.datatype == "email" %}
                                        <a href="?{{ cell_column.key }}={{ cell.data }}&amp;action={{ action }}">{{ cell.data }}</a>
                                    {% else %}
                                        {{ cell.data }}
                                    {% endif %}
                                {% else %}
                                    {{ cell|default:"---" }}
                                {% endif %}
                            </td>
                            {% endwith %}
                            {% endwith %}
                        {% endfor %}
                    </tr>
                {% endfor %}
            {% else %}
                <tr class='ignore'>
                    <td colspan='4'>No results</td>
                </tr>
            {% endif %}

        </tbody>
    </table>
</form>

<br/>
<br/>


    </div>
</div>

{% endif %} {% comment %}cluster_id{% endcomment %}

{% endif %}{% comment %}not zato_clusters{% endcomment %} {% endblock %}
